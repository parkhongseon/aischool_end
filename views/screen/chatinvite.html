{% extends 'layout.html' %}
{% block content %}
<section class="team">

    <div class="team-make">
        <img src="/img/logo.png" class="team__logo" alt="">
        <div class="search-container">
            <input type="text" placeholder="ì´ë¦„ì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”!" class="search-input" id="user_search">
            <button class="search-btn" id="search_btn">ê²€ìƒ‰</button>
        </div>
        <div class="user_search"></div>
        <div class="team__add">
            <input type="text" style="display:none;" value="{{params}}" name="chat_idx" class="chat_idx">
            <input type="text" placeholder="íŒ€ì›ì„ ì´ˆëŒ€í•´ì£¼ì„¸ìš” :)" name="chat_inv" class="chat_invite">
            <button class="AddBtn" type="button">ì¶”ê°€</button>
        </div>
        <div class="invite__user">

        </div>
        <a href="/chat"><button class="inviteBtn" type="button">ì´ˆëŒ€í•˜ê¸°</button></a>
    </div>

</section>
<script>

    $('.AddBtn').click((e) => {
        let url = '/chat/chat_inv'
        fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                room_idx: $('.chat_idx').val(),
                invite: $('.chat_invite').val()
            })
        })
            .then(res => res.json()) // (res) =>{(return res.json)}
            .then(res => {                        //ì±„íŒ…ë°© ìƒì„±í•˜ë©´ ìƒì‹  ë£¸ë²ˆí˜¸ë¥¼ ê°€ì ¸ì˜´. ì´ê±¸ ë‹¤ì‹œ ë…¸ë“œì— ë³´ë‚´ì¤˜ì•¼í•¨.
                console.log(res)
                if (res == "1") {
                    alert("í•´ë‹¹í•˜ëŠ” íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤")
                } else {
                    $('.invite__user').append(`<span>${res}</span>`)
                }
                $('.chat_invite').val('')
            }

            )
    })


    $(document).ready(function () {  //ì±„íŒ…ë‚´ìš© enter ëˆ„ë¥¼ ì‹œ ì „ì†¡í•˜ê¸°
        // Enter í‚¤ë¥¼ ëˆŒë €ì„ ë•Œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
        $('.chat_invite').keyup(function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                $('.AddBtn').click();
            }
        });
    });
    // ê·¸ë£¹ì› ê²€ìƒ‰
    $('#search_btn').click((e) => {
        let user_name = $('#user_search').val()
        let url = '/user_search'
        $('.user_search').html('');
        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                user_name: user_name
            })
        })
            .then((res) => res.json())
            .then((res) => {
                console.log(res.search)
                if (res == 'ì•„ì´ë””ê°€ ì¡´ì¬í•˜ì§€ ì•Šë„¤ìš”ğŸ˜¥') {
                    $('.user_search').text(res);
                } else {
                        for(i = 0 ; i <= res.search.length ; i++){

                 
                    $('.user_search').append(`<span>ì•„ì´ë””:  ${res.search[i].user_id}  
                        ë°˜(ê³¼ì •): ${res.search[i].user_class}</span><br><br>`);
                }}


            });

    })


</script>
{% endblock %}